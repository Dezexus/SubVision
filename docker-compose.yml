version: '3.8'

services:
  subvision:
    build: .
    container_name: subvision_all_in_one
    restart: unless-stopped
    ports:
      - "7860:7860"
    volumes:
      # Persist user uploads on host & cache ML models in a named volume.
      - ./backend/uploads:/app/backend/uploads
      - paddle_models:/root/.paddleocr
      - paddlex_cache:/root/.paddlex
    environment:
      - PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK=True
      - FLAGS_fraction_of_gpu_memory_to_use=0.9
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility,video
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [compute, utility, video]
    shm_size: '8gb'

volumes:
  paddle_models:
  paddlex_cache:   # <--- ДОБАВИТЬ ЭТУ СТРОКУ В КОНЦЕ ФАЙЛА
